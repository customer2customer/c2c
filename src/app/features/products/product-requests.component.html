<section class="requests">
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner" aria-label="Saving request"></div>
  </div>
  <header class="header">
    <div>
      <h1>Request a product or service</h1>
      <p>Tell admins what you need. Approved requests are shown publicly for providers to pick up.</p>
    </div>
    <div class="actions">
      <button type="button" (click)="loadSamples()">Load sample data</button>
      <button type="button" class="ghost" (click)="clearAll()">Clear data</button>
    </div>
  </header>

  <section class="grid">
    <form [formGroup]="form" (ngSubmit)="submit()" class="card" novalidate>
      <h3>Submit a request</h3>
      <label>
        Title
        <input formControlName="title" placeholder="E.g. Need organic veggies" required />
        <small class="error" *ngIf="form.controls['title'].invalid && form.controls['title'].touched"
          >Please enter at least 3 characters.</small
        >
      </label>
      <label>
        Category
        <select formControlName="category">
          <option *ngFor="let option of categories" [value]="option.value">{{ option.label }}</option>
        </select>
      </label>
      <label>
        Description
        <textarea rows="3" formControlName="description" placeholder="Add details so admins can help faster"></textarea>
        <small class="error" *ngIf="form.controls['description'].invalid && form.controls['description'].touched"
          >Description is required.</small
        >
      </label>
      <button type="submit">Send request</button>
      <p class="error" *ngIf="hasError">Could not send request.</p>
    </form>

    <article class="card">
      <h3>Approved requests</h3>
      <ul>
        <li *ngFor="let item of approved$ | async">
          <strong>{{ item.title }}</strong>
          <p>{{ item.description }}</p>
          <small>By {{ item.requesterName }}</small>
        </li>
      </ul>
    </article>
  </section>

  <section class="card" *ngIf="(myRequests$ | async)?.length">
    <h3>Your submissions</h3>
    <div *ngFor="let req of myRequests$ | async" class="row">
      <div>
        <strong>{{ req.title }}</strong>
        <p>{{ req.description }}</p>
        <small>Status: {{ req.approved ? 'Approved' : 'Pending admin review' }}</small>
      </div>
      <button type="button" (click)="update(req)">Mark for re-review</button>
    </div>
  </section>
</section>
