<section class="requests">
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner" aria-label="Saving request"></div>
  </div>
  <header class="header">
    <div>
      <h1>Request a product or service</h1>
      <p>Tell admins what you need. Approved requests are shown publicly for providers to pick up.</p>
    </div>
    <div class="actions">
      <button type="button" (click)="loadSamples()">Load sample data</button>
      <button type="button" class="ghost" (click)="clearAll()">Clear data</button>
    </div>
  </header>

  <section class="grid">
    <form [formGroup]="form" (ngSubmit)="submit()" class="card" novalidate>
      <h3>Submit a request</h3>
      <p class="muted" *ngIf="editingRequest">Editing "{{ editingRequest.title }}"</p>
      <label>
        Title
        <input formControlName="title" placeholder="E.g. Need organic veggies" required />
        <small class="error" *ngIf="form.controls['title'].invalid && form.controls['title'].touched"
          >Please enter at least 3 characters.</small
        >
      </label>
      <label>
        Category
        <select formControlName="category">
          <option *ngFor="let option of categories" [value]="option.value">{{ option.label }}</option>
        </select>
      </label>
      <label>
        Description
        <textarea rows="3" formControlName="description" placeholder="Add details so admins can help faster"></textarea>
        <small class="error" *ngIf="form.controls['description'].invalid && form.controls['description'].touched"
          >Description is required.</small
        >
      </label>
      <div class="inline-actions">
        <button type="submit">{{ editingRequest ? 'Update request' : 'Send request' }}</button>
        <button type="button" class="ghost" *ngIf="editingRequest" (click)="cancelEdit()">Cancel edit</button>
      </div>
      <p class="error" *ngIf="hasError">Could not send request.</p>
    </form>

    <article class="card">
      <h3>Approved requests</h3>
      <ul class="approved-list">
        <li *ngFor="let item of approved$ | async" class="approved-list__item">
          <div>
            <strong>{{ item.title }}</strong>
            <p>{{ item.description }}</p>
          </div>
          <div class="chip">{{ item.category }}</div>
          <small>By {{ item.requesterName }}</small>
        </li>
      </ul>
    </article>
  </section>

  <section class="card" *ngIf="(myRequests$ | async)?.length">
    <h3>Your submissions</h3>
    <ul class="owned-list">
      <li *ngFor="let req of myRequests$ | async" class="owned-list__item">
        <div class="owned-list__content">
          <strong>{{ req.title }}</strong>
          <p>{{ req.description }}</p>
          <small>Status: {{ req.approved ? 'Approved' : 'Pending admin review' }}</small>
        </div>
        <div class="owned-list__actions">
          <button type="button" class="secondary" (click)="startEdit(req)">Edit</button>
          <button type="button" (click)="markForReview(req)">Mark for re-review</button>
        </div>
      </li>
    </ul>
  </section>
</section>
